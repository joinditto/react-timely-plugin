{"version":3,"file":"index.modern.js","sources":["../src/components/TimelyModal.tsx","../src/timely.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\r\n\r\nimport { ReactComponent as CloseIcon } from '../assets/close-icon.svg'\r\n\r\nconst TimelyModal: React.FC<any> = ({ isOpen, onClose, children }) => {\r\n  const isBrowser = typeof window !== 'undefined'\r\n\r\n  const [viewport, setViewport] = useState<{ width: number; height: number }>({\r\n    width: 0,\r\n    height: 0\r\n  })\r\n\r\n  const handleViewportChange = () => {\r\n    if (isBrowser) {\r\n      setViewport({\r\n        width: document.documentElement.clientWidth,\r\n        height: document.documentElement.clientHeight\r\n      })\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (isBrowser) {\r\n      window.addEventListener('resize', handleViewportChange)\r\n      setViewport({\r\n        width: document.documentElement.clientWidth,\r\n        height: document.documentElement.clientHeight\r\n      })\r\n    }\r\n    return () => {\r\n      if (isBrowser) {\r\n        window.removeEventListener('resize', handleViewportChange)\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  return (\r\n    isOpen && (\r\n      <div\r\n        style={{\r\n          position: 'fixed',\r\n          zIndex: 1,\r\n          left: '0',\r\n          top: '0',\r\n          width: '100%',\r\n          height: '100%',\r\n          backgroundColor: 'rgba(0,0,0,0.4)'\r\n        }}\r\n      >\r\n        <button\r\n          style={{\r\n            background: 'transparent',\r\n            border: 'none',\r\n            float: 'right',\r\n            marginRight: 15,\r\n            marginTop: 15,\r\n            fontWeight: 'bold',\r\n            width: 30,\r\n            cursor: 'pointer'\r\n          }}\r\n          onClick={onClose}\r\n        >\r\n          <CloseIcon />\r\n        </button>\r\n        <div\r\n          style={{\r\n            position: 'fixed',\r\n            bottom: '0%',\r\n            top: viewport.width < 768 ? undefined : '50%',\r\n            left: viewport.width < 768 ? undefined : '50%',\r\n            transform:\r\n              viewport.width < 768 ? undefined : 'translate(-50%, -50%)',\r\n            width:\r\n              viewport.width < 768\r\n                ? '100%'\r\n                : viewport.width < 1124\r\n                ? '80%'\r\n                : 980,\r\n            height: 550\r\n          }}\r\n        >\r\n          {children}\r\n        </div>\r\n      </div>\r\n    )\r\n  )\r\n}\r\n\r\nexport default TimelyModal\r\n","import React, { Fragment, useState } from 'react'\r\nimport TimelyModal from './components/TimelyModal'\r\nimport { ReactComponent as Loader } from './assets/loader.svg'\r\n\r\ntype Optional<T extends object> = {\r\n  [P in keyof T]?: T[P]\r\n}\r\n\r\nexport type Embed = Optional<{\r\n  embed_domain: string\r\n  embed_path: string\r\n  embed_type: 'popup' | 'inline'\r\n}>\r\n\r\nexport type Prefill = Optional<{\r\n  name: string\r\n  email: string\r\n  phone: string\r\n  product: string\r\n  query: string\r\n  date: Date\r\n}>\r\n\r\nexport type Utm = Optional<{\r\n  utm_campaign: string\r\n  utm_source: string\r\n  utm_medium: string\r\n  utm_content: string\r\n  utm_term: string\r\n  ref: string\r\n  referral_url: string\r\n  referral_code: string\r\n}>\r\n\r\nexport type IframeTitle = string\r\n\r\ninterface TimelyWidgetProps {\r\n  url: string\r\n  prefill?: Prefill\r\n  utm?: Utm\r\n  iframeTitle?: IframeTitle\r\n  embed?: Embed\r\n}\r\n\r\ninterface TimelyWidgetState {\r\n  isOpen: boolean\r\n  content: JSX.Element | null\r\n  confirmClose: boolean\r\n}\r\n\r\nclass TimelyWidget extends React.Component<any, TimelyWidgetState> {\r\n  static singletonRef: any\r\n\r\n  constructor(props: any) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      isOpen: false,\r\n      content: null,\r\n      confirmClose: false\r\n    }\r\n\r\n    TimelyWidget.singletonRef = this\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param event\r\n   */\r\n  handleMessage = (event: any) => {\r\n    const { data } = event\r\n    if (data.from === 'timely') {\r\n      if (data.action === 'confirm-close') {\r\n        this.setState({ isOpen: false, confirmClose: false })\r\n      } else if (data.action === 'reset-confirmation') {\r\n        this.setState({ confirmClose: false })\r\n      }\r\n    }\r\n  }\r\n\r\n  // we have to handle close confirmations from the iframe loaded listening for such a message\r\n  componentDidMount(): void {\r\n    window.addEventListener('message', this.handleMessage, false)\r\n  }\r\n\r\n  // free up the event listeners on unmount\r\n  componentWillUnmount(): void {\r\n    window.removeEventListener('message', this.handleMessage)\r\n  }\r\n\r\n  show = (props: TimelyWidgetProps) => {\r\n    this.setState({\r\n      isOpen: true,\r\n      content: <TimelyIframe {...props} />\r\n    })\r\n  }\r\n\r\n  close = () => {\r\n    if (!this.state.confirmClose && this.state.isOpen) {\r\n      this.setState({ confirmClose: true })\r\n      if (window && window.document) {\r\n        const timelyIframe: HTMLIFrameElement | null =\r\n          window?.document?.getElementById('timely-iframe') as HTMLIFrameElement\r\n\r\n        if (timelyIframe) {\r\n          timelyIframe.contentWindow?.postMessage(\r\n            { from: 'react-timely', action: 'close' },\r\n            '*'\r\n          )\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { isOpen } = this.state\r\n\r\n    return (\r\n      <TimelyModal\r\n        isOpen={isOpen}\r\n        onClose={this.close}\r\n        closeBtn={!this.state.confirmClose}\r\n      >\r\n        <Fragment>{this.state.content}</Fragment>\r\n      </TimelyModal>\r\n    )\r\n  }\r\n}\r\n\r\nconst TimelyProvider: React.FC = ({ children }) => {\r\n  return (\r\n    <Fragment>\r\n      {children}\r\n      <TimelyWidget />\r\n    </Fragment>\r\n  )\r\n}\r\n\r\nexport { TimelyProvider }\r\n\r\nexport const TimelyIframe: React.FC<TimelyWidgetProps> = ({\r\n  url,\r\n  utm,\r\n  embed,\r\n  iframeTitle\r\n}) => {\r\n  const [loading, showLoader] = useState<boolean>(true)\r\n\r\n  const formUrl = () => {\r\n    const queryStringIndex = url.indexOf('?')\r\n    const hasQueryString = queryStringIndex > -1\r\n    const queryString = hasQueryString ? url.slice(queryStringIndex + 1) : null\r\n    const baseUrl = hasQueryString ? url.slice(0, queryStringIndex) : url\r\n\r\n    const updatedQueryString = [\r\n      queryString,\r\n      utm\r\n        ? Object.keys(utm)\r\n            .map((utmParam) => `${utmParam}=${utm[utmParam]}`)\r\n            .join('&')\r\n        : null,\r\n      embed\r\n        ? Object.keys(embed)\r\n            .map((embedProp) => `${embedProp}=${embed[embedProp]}`)\r\n            .join('&')\r\n        : null\r\n    ]\r\n      .filter((item) => item !== null)\r\n      .join('&')\r\n\r\n    return `${baseUrl}?${updatedQueryString}`\r\n  }\r\n\r\n  const finalUrl = formUrl()\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        width: '100%',\r\n        height: '100%',\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        justifyContent: 'center',\r\n        alignItems: 'center'\r\n      }}\r\n    >\r\n      {loading && (\r\n        <div\r\n          style={{\r\n            position: 'absolute',\r\n            width: '100%',\r\n            height: '100%',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n            zIndex: -1\r\n          }}\r\n        >\r\n          <Loader\r\n            style={{\r\n              width: 75,\r\n              height: 57\r\n            }}\r\n          />\r\n        </div>\r\n      )}\r\n      <iframe\r\n        id='timely-iframe'\r\n        src={finalUrl}\r\n        frameBorder={0}\r\n        width='100%'\r\n        height='100%'\r\n        title={iframeTitle ? iframeTitle : 'Ditto Timely'}\r\n        onLoad={() => showLoader(false)}\r\n        allowTransparency={true}\r\n        style={{ visibility: loading ? 'hidden' : 'visible' }}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport const openPopupWidget = (options: TimelyWidgetProps) => {\r\n  TimelyWidget.singletonRef.show(options)\r\n}\r\n"],"names":["TimelyModal","isOpen","onClose","children","isBrowser","window","viewport","setViewport","useState","width","height","handleViewportChange","document","documentElement","clientWidth","clientHeight","useEffect","addEventListener","removeEventListener","React","style","position","zIndex","left","top","backgroundColor","background","border","float","marginRight","marginTop","fontWeight","cursor","onClick","CloseIcon","bottom","undefined","transform","TimelyWidget","Component","constructor","props","event","data","from","action","setState","confirmClose","content","TimelyIframe","state","timelyIframe","getElementById","contentWindow","postMessage","singletonRef","componentDidMount","handleMessage","componentWillUnmount","render","close","closeBtn","Fragment","TimelyProvider","url","utm","embed","iframeTitle","loading","showLoader","formUrl","queryStringIndex","indexOf","hasQueryString","queryString","slice","baseUrl","updatedQueryString","Object","keys","map","utmParam","join","embedProp","filter","item","finalUrl","display","flexDirection","justifyContent","alignItems","Loader","id","src","frameBorder","title","onLoad","allowTransparency","visibility","openPopupWidget","options","show"],"mappings":"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"}